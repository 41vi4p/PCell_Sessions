<!doctype html>
<html lang="en">

<head>
 <meta charset="utf-8" />
 <meta name="viewport" content="width=device-width,initial-scale=1" />
 <title>CRC Email Portal</title>
</head>

<body>
 <h1>CRCE Student Login</h1>
 <form id="loginForm">
  <label>Roll No: <input id="roll" required /></label><br />
  <label>Password: <input id="password" type="password" required /></label><br />
  <button type="submit">Login</button>
 </form>
 <div id="msg" style="color:red;margin-top:8px"></div>

 <script>
  document.getElementById('loginForm').addEventListener('submit', async (e) => {
   e.preventDefault();
   const roll = document.getElementById('roll').value.trim();
   const password = document.getElementById('password').value;
   const res = await fetch('/api/login', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({roll, password})
   });
   if (!res.ok) {
    const err = await res.json().catch(() => ({detail: 'Login failed'}));
    document.getElementById('msg').textContent = err.detail || 'Login failed';
    return;
   }
   const data = await res.json();
   localStorage.setItem('crc_token', data.access_token);
   localStorage.setItem('crc_roll', data.roll);
   if (data.name) localStorage.setItem('crc_name', data.name);
   if (data.email) localStorage.setItem('crc_email', data.email);
   window.location.href = '/dashboard';
  });
 </script>
</body>

</html>